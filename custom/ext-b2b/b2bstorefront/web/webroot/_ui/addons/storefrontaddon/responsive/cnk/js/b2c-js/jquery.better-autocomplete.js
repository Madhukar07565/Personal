(function(e){e.fn.betterAutocomplete=function(n){var r={init:function(n,r,i){var s=e(this),o=new t(s,n,r,i);s.data("better-autocomplete",o);o.enable()},enable:function(e){e.enable()},disable:function(e){e.disable()},destroy:function(e){e.destroy()}},i=Array.prototype.slice.call(arguments,1);this.each(function(){switch(n){case"init":r[n].apply(this,i);break;case"enable":case"disable":case"destroy":var s=e(this).data("better-autocomplete");if(s instanceof t){r[n].call(this,s)}break;default:e.error(["Method",n,"does not exist in jQuery.betterAutocomplete."].join(" "))}});return this};var t=function(t,r,i,s){function T(n){if(e.type(n)=="object"&&n.type=="keyup"&&e.inArray(n.keyCode,[38,40])>=0){return}var r=s.canonicalQuery(t.val(),i.caseSensitive);clearTimeout(l);l=null;N();if(r.length>=i.charLimit&&!e.isArray(u[r])&&e.inArray(r,c)==-1){v.empty();if(d){x(r)}else{l=setTimeout(function(){x(r);l=null},i.delay)}}}var o="",u={},a=[],f=0,l,c=[],h=false,p={},d=e.type(r)!="string",v=e("<ul />").addClass("better-autocomplete"),m=true,g=null;i=e.extend({charLimit:d?1:3,delay:350,caseSensitive:false,cacheLimit:d?0:256,remoteTimeout:1e4,crossOrigin:false,selectKeys:[9,13],autoHighlight:true},i);s=e.extend({},n,s);s.insertSuggestionList(v,t);p.focus=function(){g||N(true)};p.blur=function(){if(g){t.focus()}else{N()}};p.keydown=function(t){var n=w();if(e.inArray(t.keyCode,[38,40])>=0&&v.children().length>0){var r,s=e(".result",v).length;switch(t.keyCode){case 38:r=Math.max(-1,n-1);break;case 40:r=Math.min(s-1,n+1);break}h=true;b(r,"key",true);return false}else if(e.inArray(t.keyCode,i.selectKeys)>=0&&!t.shiftKey&&!t.ctrlKey&&!t.altKey&&!t.metaKey){S();return t.keyCode==9}};p.keyup=p.click=T;v.delegate(".result",{mouseenter:function(){if(h){return}b(e(".result",v).index(e(this)),"mouse")},mousemove:function(){h=false},mousedown:function(){S();return false}});v.mousedown(function(){clearTimeout(g);g=setTimeout(function(){g=null},50);return false});v.mouseleave(function(){if(!i.autoHighlight){b(-1)}});this.enable=function(){t.attr("autocomplete","OFF").attr("aria-autocomplete","list");t.bind(p)};this.disable=function(){t.removeAttr("autocomplete").removeAttr("aria-autocomplete");v.hide();t.unbind(p)};this.destroy=function(){v.remove();t.unbind(p);t.removeData("better-autocomplete")};var y=function(e,t){f+=t.length;while(f>i.cacheLimit&&a.length){var n=a.shift();f-=u[n].length;delete u[n]}a.push(e);u[e]=t};var b=function(n,r,i){var o=w(),u=e(".result",v);u.removeClass("highlight");if(n<0){return}u.eq(n).addClass("highlight");if(o!=n){var a=E(n);s.highlight(a,t,r)}var f=n==0||n<o,l=u.eq(n);if(!i){return}if(l.prev().is(".group")&&f){l=l.prev()}if(l.position().top<0){v.scrollTop(l.position().top+v.scrollTop())}else if(l.position().top+l.outerHeight()>v.height()){v.scrollTop(l.position().top+v.scrollTop()+l.outerHeight()-v.height())}};var w=function(){var t=e(".result.highlight",v);ind=e(".result",v).index(t);return ind};var E=function(t){var n=e(".result",v).eq(t);if(!n.length){return}return n.data("result")};var S=function(){var e=w();if(e>=0){var n=E(e);s.select(n,t);T()}};var x=function(n){if(d){y(n,s.queryLocalResults(n,r,i.caseSensitive));N()}else{c.push(n);var o=s.constructURL(r,n);s.beginFetching(t);s.fetchRemoteData(o,function(r){var i=s.processRemoteData(r);if(!e.isArray(i)){i=[]}y(n,i);c=e.grep(c,function(e){return e!=n});if(!c.length){s.finishFetching(t)}N()},i.remoteTimeout,i.crossOrigin)}};var N=function(n){var r=s.canonicalQuery(t.val(),i.caseSensitive);if(!e.isArray(u[r])){o=null;v.empty()}else if(o!==r){o=r;C(u[r]);if(i.autoHighlight&&e(".result",v).length>0){b(0,"auto")}}if((t.is(":focus")||n)&&!v.is(":empty")){v.filter(":hidden").show().scrollTop(v.data("scroll-top"));if(m){m=false;s.afterShow(v)}}else if(v.is(":visible")){v.data("scroll-top",v.scrollTop()).hide();if(!m){m=true;s.afterHide(v)}}};var C=function(t){v.empty();var n={};e.each(t,function(t,r){if(e.type(r)!="object"){return}var i=s.themeResult(r);if(e.type(i)!="string"){return}var o=s.getGroup(r);if(e.type(o)=="string"&&!n[o]){var u=e("<li />").addClass("group").append(e("<h3 />").html(o)).appendTo(v);n[o]=u}var a=e("<li />").addClass("result").append(i).data("result",r).addClass(r.addClass);if(e.type(o)!="string"&&!v.children().first().is(".result")){v.prepend(a);return}var f=e.type(o)=="string"?n[o]:v.children().first();var l=f.nextUntil(".group").last();a.insertAfter(l.length?l:f)})}};var n={select:function(e,t){t.val(e.title)},highlight:function(e,t,n){},themeResult:function(t){var n=[];if(e.type(t.title)=="string"){n.push("<h4>",t.title,"</h4>")}if(e.type(t.description)=="string"){n.push("<p>",t.description,"</p>")}return n.join("")},queryLocalResults:function(t,n,r){if(!e.isArray(n)){return[]}var i=[];e.each(n,function(n,s){switch(e.type(s)){case"string":if((r?s:s.toLowerCase()).indexOf(t)>=0){i.push({title:s})}break;case"object":if(e.type(s.title)=="string"&&(r?s.title:s.title.toLowerCase()).indexOf(t)>=0){i.push(s)}else if(e.type(s.description)=="string"&&(r?s.description:s.description.toLowerCase()).indexOf(t)>=0){i.push(s)}break}});return i},fetchRemoteData:function(t,n,r,i){e.ajax({url:t,dataType:i&&!e.support.cors?"jsonp":"json",timeout:r,success:function(e,t){n(e)},error:function(e,t,r){n()}})},processRemoteData:function(t){if(e.isArray(t)){return t}else{return[]}},getGroup:function(t){if(e.type(t.group)=="string"){return t.group}},beginFetching:function(e){e.addClass("fetching")},finishFetching:function(e){e.removeClass("fetching")},afterShow:function(e){},afterHide:function(e){},constructURL:function(e,t){return e+(e.indexOf("?")>-1?"&":"?")+"q="+encodeURIComponent(t)},canonicalQuery:function(t,n){var r=e.trim(t);if(!n){r=r.toLowerCase()}return r},insertSuggestionList:function(e,t){e.width(t.outerWidth()-2).css({position:"absolute",left:t.position().left,top:t.position().top+t.outerHeight()}).hide().insertAfter(t)}};var r=e.expr[":"];if(!r.focus){r.focus=function(e){return e===document.activeElement&&(e.type||e.href)}}})(jQuery)